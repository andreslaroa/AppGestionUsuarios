<form id="ouForm">
    <div>
        <label for="ouPrincipal">OU Principal:</label>
        <select id="ouPrincipal" name="ouPrincipal" onchange="fetchOUSecundarias(); fetchDepartamentos();">
            <option value="">Seleccione una OU Principal</option>
            @foreach (var ou in ViewBag.OUPrincipales as List<string>)
            {
                <option value="@ou">@ou</option>
            }
        </select>
    </div>

    <div>
        <label for="ouSecundaria">OU Secundaria:</label>
        <select id="ouSecundaria" name="ouSecundaria">
            <option value="">Seleccione una OU Secundaria</option>
        </select>
    </div>

    <div>
        <label for="departamento">DEPARTAMENTO :</label>
        <select id="departamento" name="departamento">
            <option value="">Seleccione un departamento</option>
        </select>
    </div>
</form>

<script>
    // Función para obtener las OUs Secundarias
    function fetchOUSecundarias() {
        const ouPrincipal = document.getElementById('ouPrincipal').value;
        const ouSecundaria = document.getElementById('ouSecundaria');
        ouSecundaria.innerHTML = '<option value="">Seleccione una OU Secundaria</option>';

        if (ouPrincipal) {
            console.log('OU Principal seleccionada:', ouPrincipal);
            fetch('/UserManagement/GetOUSecundarias', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ ouPrincipal })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la respuesta de la red');
                    }
                    return response.json();
                })
                .then(data => {
                    data.forEach(ou => {
                        const option = document.createElement('option');
                        option.value = ou;
                        option.textContent = ou;
                        ouSecundaria.appendChild(option);
                    });
                })
                .catch(error => console.error('Error al obtener las OUs secundarias:', error));
        }
    }

    // Nueva función para obtener los Departamentos
    function fetchDepartamentos() {
        const ouPrincipal = document.getElementById('ouPrincipal').value;
        const departamento = document.getElementById('departamento');
        departamento.innerHTML = '<option value="">Seleccione un departamento</option>';

        if (ouPrincipal) {
            console.log('OU Principal seleccionada para departamentos:', ouPrincipal);
            fetch('/UserManagement/GetDepartamentos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ ouPrincipal })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la respuesta de la red');
                    }
                    return response.json();
                })
                .then(data => {
                    data.forEach(dep => {
                        const option = document.createElement('option');
                        option.value = dep;
                        option.textContent = dep;
                        departamento.appendChild(option);
                    });
                })
                .catch(error => console.error('Error al obtener los departamentos:', error));
        }
    }
</script>
